<div class="admin-dashboard">
  <div class="container">
    <h1>Dashboard Administrateur</h1>
    
    <div class="admin-stats">
      <div class="stat-card card">
        <h3>Total Annonces</h3>
        <p class="stat-number">{{ totalAnnonces }}</p>
      </div>
      <div class="stat-card card">
        <h3>En attente</h3>
        <p class="stat-number">{{ pendingAnnonces }}</p>
      </div>
      <div class="stat-card card">
        <h3>Total Utilisateurs</h3>
        <p class="stat-number">{{ totalUsers }}</p>
      </div>
      <div class="stat-card card">
        <h3>Revenus (mois)</h3>
        <p class="stat-number">{{ monthlyRevenue | number }} FCFA</p>
      </div>
    </div>
    
    <div class="admin-tabs">
      <button class="tab-btn" [class.active]="activeTab === 'annonces'" 
              (click)="activeTab = 'annonces'">Annonces</button>
      <button class="tab-btn" [class.active]="activeTab === 'users'" 
              (click)="activeTab = 'users'">Utilisateurs</button>
      <button class="tab-btn" [class.active]="activeTab === 'categories'" 
              (click)="activeTab = 'categories'">Cat√©gories</button>
      <button class="tab-btn" [class.active]="activeTab === 'tarifs'" 
              (click)="activeTab = 'tarifs'">Tarifs</button>
      <button class="tab-btn" [class.active]="activeTab === 'stats'" 
              (click)="activeTab = 'stats'">Statistiques</button>
    </div>
    
    <div class="tab-content" *ngIf="activeTab === 'annonces'">
      <div class="tab-header">
        <h2>Gestion des annonces</h2>
      </div>
      <div class="annonces-list">
        <div *ngFor="let annonce of allAnnonces" class="annonce-item card">
          <div class="annonce-header">
            <div class="annonce-info">
              <img [src]="getImageUrl(annonce.images && annonce.images.length > 0 ? annonce.images[0] : '')" [alt]="annonce.title" 
                   *ngIf="annonce.images && annonce.images.length > 0" class="mini-image">
              <div>
                <h4>{{ annonce.title }}</h4>
                <p>{{ annonce.price | number }} FCFA - {{ annonce.sellerName }}</p>
                <p class="annonce-meta">Cat√©gorie: {{ annonce.category }} | Vues: {{ annonce.viewCount }}</p>
              </div>
            </div>
            <div class="annonce-actions">
              <span class="badge" [ngClass]="'badge-' + annonce.status.toLowerCase()">
                {{ getStatusLabel(annonce.status) }}
              </span>
              <button class="btn btn-primary btn-sm" 
                      *ngIf="annonce.status === 'PENDING'"
                      (click)="approveAnnonce(annonce.id)">Approuver</button>
              <button class="btn btn-outline btn-sm" 
                      *ngIf="annonce.status === 'PENDING'"
                      (click)="rejectAnnonce(annonce.id)">Rejeter</button>
              <button class="btn btn-danger btn-sm" 
                      (click)="deleteAnnonce(annonce.id)">Supprimer</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-content" *ngIf="activeTab === 'users'">
      <div class="tab-header">
        <h2>Gestion des utilisateurs</h2>
        <button class="btn btn-primary" (click)="openUserForm()">+ Nouvel utilisateur</button>
      </div>
      
      <div class="users-list">
        <table class="data-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nom</th>
              <th>Email</th>
              <th>R√¥le</th>
              <th>Actif</th>
              <th>Email v√©rifi√©</th>
              <th>Annonces</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of users">
              <td>{{ user.id }}</td>
              <td>{{ user.firstName }} {{ user.lastName }}</td>
              <td>{{ user.email }}</td>
              <td><span class="badge badge-{{ user.role.toLowerCase() }}">{{ getRoleLabel(user.role) }}</span></td>
              <td><span [class]="user.enabled ? 'text-success' : 'text-danger'">{{ user.enabled ? '‚úì' : '‚úó' }}</span></td>
              <td><span [class]="user.emailVerified ? 'text-success' : 'text-danger'">{{ user.emailVerified ? '‚úì' : '‚úó' }}</span></td>
              <td>{{ user.annoncesCount || 0 }}</td>
              <td>
                <button class="btn btn-sm btn-primary" (click)="openUserForm(user)">Modifier</button>
                <button class="btn btn-sm btn-danger" 
                        *ngIf="user.role !== 'ADMIN'"
                        (click)="deleteUser(user.id)">Supprimer</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- User Form Modal -->
      <div class="modal-overlay" *ngIf="showUserForm" (click)="showUserForm = false">
        <div class="modal-content" (click)="$event.stopPropagation()" [formGroup]="userForm">
          <div class="modal-header">
            <h3>{{ editingUser ? 'Modifier l\'utilisateur' : 'Nouvel utilisateur' }}</h3>
            <button class="close-btn" (click)="showUserForm = false">√ó</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label>Email *</label>
              <input type="email" formControlName="email" class="form-control">
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Pr√©nom *</label>
                <input type="text" formControlName="firstName" class="form-control">
              </div>
              <div class="form-group">
                <label>Nom *</label>
                <input type="text" formControlName="lastName" class="form-control">
              </div>
            </div>
            <div class="form-group">
              <label>T√©l√©phone</label>
              <input type="tel" formControlName="phone" class="form-control">
            </div>
            <div class="form-group">
              <label>Adresse</label>
              <input type="text" formControlName="address" class="form-control">
            </div>
            <div class="form-group">
              <label>WhatsApp</label>
              <input type="tel" formControlName="whatsapp" class="form-control">
            </div>
            <div class="form-group">
              <label>R√¥le *</label>
              <select formControlName="role" class="form-control">
                <option value="USER">Utilisateur</option>
                <option value="VENDEUR">Vendeur</option>
                <option value="ADMIN">Administrateur</option>
              </select>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>
                  <input type="checkbox" formControlName="enabled"> Actif
                </label>
              </div>
              <div class="form-group">
                <label>
                  <input type="checkbox" formControlName="emailVerified"> Email v√©rifi√©
                </label>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline" (click)="showUserForm = false">Annuler</button>
            <button class="btn btn-primary" (click)="saveUser()" [disabled]="userForm.invalid">Enregistrer</button>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-content" *ngIf="activeTab === 'categories'">
      <div class="tab-header">
        <h2>Gestion des cat√©gories</h2>
        <button class="btn btn-primary" (click)="openCategoryForm()">+ Nouvelle cat√©gorie</button>
      </div>
      
      <div class="categories-list">
        <div *ngFor="let category of categories" class="category-card card">
          <div class="category-header">
            <div class="category-info">
              <span class="category-icon">{{ category.icon || 'üìÅ' }}</span>
              <div>
                <h4>{{ category.name }}</h4>
                <p *ngIf="category.description">{{ category.description }}</p>
              </div>
            </div>
            <div class="category-actions">
              <span class="badge" [ngClass]="category.active ? 'badge-success' : 'badge-danger'">
                {{ category.active ? 'Actif' : 'Inactif' }}
              </span>
              <button class="btn btn-sm btn-primary" (click)="openCategoryForm(category)">Modifier</button>
              <button class="btn btn-sm btn-danger" (click)="deleteCategory(category.id)">Supprimer</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Category Form Modal -->
      <div class="modal-overlay" *ngIf="showCategoryForm" (click)="showCategoryForm = false">
        <div class="modal-content" (click)="$event.stopPropagation()" [formGroup]="categoryForm">
          <div class="modal-header">
            <h3>{{ editingCategory ? 'Modifier la cat√©gorie' : 'Nouvelle cat√©gorie' }}</h3>
            <button class="close-btn" (click)="showCategoryForm = false">√ó</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label>Nom *</label>
              <input type="text" formControlName="name" class="form-control" placeholder="Ex: V√™tements">
            </div>
            <div class="form-group">
              <label>Description</label>
              <textarea formControlName="description" class="form-control" rows="3"></textarea>
            </div>
            <div class="form-group">
              <label>Ic√¥ne (emoji)</label>
              <input type="text" formControlName="icon" class="form-control" placeholder="Ex: üëï">
            </div>
            <div class="form-group">
              <label>
                <input type="checkbox" formControlName="active"> Actif
              </label>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline" (click)="showCategoryForm = false">Annuler</button>
            <button class="btn btn-primary" (click)="saveCategory()" [disabled]="categoryForm.invalid">Enregistrer</button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="tab-content" *ngIf="activeTab === 'tarifs'">
      <div class="tab-header">
        <h2>Param√©trage des tarifs</h2>
        <button class="btn btn-primary" (click)="openTarifForm()">+ Nouveau tarif</button>
      </div>
      <div class="tarifs-list">
        <div *ngFor="let tarif of tarifs" class="tarif-card card">
          <div class="tarif-header">
            <h3>{{ getPublicationTypeLabel(tarif.publicationType) }}</h3>
            <div class="tarif-actions">
              <button class="btn btn-sm btn-primary" (click)="openTarifForm(tarif)">Modifier</button>
              <button class="btn btn-sm btn-danger" (click)="deleteTarif(tarif.id)">Supprimer</button>
            </div>
          </div>
          <div class="tarif-form">
            <div class="form-group">
              <label>Prix (FCFA)</label>
              <input type="number" [(ngModel)]="tarif.price" 
                     (blur)="updateTarif(tarif)" class="form-control">
            </div>
            <div class="form-group">
              <label>Dur√©e (jours)</label>
              <input type="number" [(ngModel)]="tarif.durationDays" 
                     (blur)="updateTarif(tarif)" class="form-control">
            </div>
            <div class="form-group">
              <label>
                <input type="checkbox" [(ngModel)]="tarif.active" 
                       (change)="updateTarif(tarif)">
                Actif
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Tarif Form Modal -->
      <div class="modal-overlay" *ngIf="showTarifForm" (click)="showTarifForm = false">
        <div class="modal-content" (click)="$event.stopPropagation()" [formGroup]="tarifForm">
          <div class="modal-header">
            <h3>{{ editingTarif ? 'Modifier le tarif' : 'Nouveau tarif' }}</h3>
            <button class="close-btn" (click)="showTarifForm = false">√ó</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label>Type de publication *</label>
              <select formControlName="publicationType" class="form-control">
                <option value="STANDARD">Standard</option>
                <option value="PREMIUM">Premium</option>
                <option value="TOP_PUB">Top Pub</option>
              </select>
            </div>
            <div class="form-group">
              <label>Prix (FCFA) *</label>
              <input type="number" formControlName="price" class="form-control" min="0">
            </div>
            <div class="form-group">
              <label>Dur√©e (jours) *</label>
              <input type="number" formControlName="durationDays" class="form-control" min="1">
            </div>
            <div class="form-group">
              <label>
                <input type="checkbox" formControlName="active"> Actif
              </label>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline" (click)="showTarifForm = false">Annuler</button>
            <button class="btn btn-primary" (click)="saveTarif()" [disabled]="tarifForm.invalid">Enregistrer</button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="tab-content" *ngIf="activeTab === 'stats'">
      <h2>Statistiques</h2>
      <div class="stats-grid">
        <div class="stat-box card">
          <h4>Revenus par jour</h4>
          <p class="stat-value">{{ dailyRevenue | number }} FCFA</p>
        </div>
        <div class="stat-box card">
          <h4>Revenus par semaine</h4>
          <p class="stat-value">{{ weeklyRevenue | number }} FCFA</p>
        </div>
        <div class="stat-box card">
          <h4>Revenus par mois</h4>
          <p class="stat-value">{{ monthlyRevenue | number }} FCFA</p>
        </div>
        <div class="stat-box card">
          <h4>Annonces les plus vues</h4>
          <p class="stat-value">{{ topViewedCount }}</p>
        </div>
      </div>
    </div>
  </div>
</div>
